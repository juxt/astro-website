---
import type { MarkdownInstance } from 'astro'
import type { AstroComponentFactory } from 'astro/runtime/server/index.js'
import { slugifyPath } from '@utils/common'
import { Blog } from '@utils/types'

export function getStaticPaths() {
  const pageModules = import.meta.glob<MarkdownInstance<Blog>>('./{*.mdx,*.md}', { eager: true })
  const pages = Object.values(pageModules)

  const onlyDrafts = pages
    .filter((page) => page.frontmatter.draft)
    .map((page) => ({
      ...page.frontmatter,
      Content: page.Content,
      slug: slugifyPath(page.url)
    }))

  const blogs = onlyDrafts.map(({ slug, token, ...rest }) => ({
    params: { slug: `drafts/${slug}` + (token ? `/${token}` : '') },
    props: { ...rest }
  }))

  return blogs
}

const { Content } = Astro.props as Blog & { Content: AstroComponentFactory }
---

<meta name='robots' content='noindex' />

<Content />
